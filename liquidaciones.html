<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Liquidaciones - MezWare</title>
  <link rel="stylesheet" href="style.css">
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1e1e1e">
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/616/616408.png">

  <style>
    /* --- ESTILOS GENERALES --- */
    :root { color-scheme: dark; }
    
    body {
        background-color: #121212; color: white; font-family: 'Segoe UI', sans-serif;
        margin: 0; display: flex; flex-direction: column; min-height: 100vh; 
    }
    main {
        flex: 1; width: 100%; max-width: 1200px; margin: 0 auto; padding: 20px; box-sizing: border-box;
    }
    header { padding: 20px; text-align: center; border-bottom: 1px solid #333; background-color: #1e1e1e; }
    header h1 { margin: 0; font-size: 1.5rem; color: var(--primary); }
    nav { display: flex; justify-content: center; padding: 10px; background-color: #181818; }
    nav a { color: #e0e0e0; font-weight: bold; text-decoration: none; }

    /* --- LAYOUT DE LIQUIDACI√ìN --- */
    .liquidacion-grid {
        display: grid;
        grid-template-columns: 1fr 350px; /* Formulario Grande | Resumen Fijo */
        gap: 20px;
        align-items: start;
    }

    /* Tarjetas */
    .card-section {
        background-color: #1e1e1e; padding: 20px; border-radius: 10px;
        border: 1px solid #333; margin-bottom: 20px;
    }
    .card-section h3 { margin-top: 0; color: var(--primary); border-bottom: 1px solid #444; padding-bottom: 10px; }

    /* Inputs */
    .form-row { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
    .form-group { flex: 1; min-width: 150px; }
    label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9rem; }
    input, select { 
        width: 100%; padding: 10px; background: #2d2d2d; border: 1px solid #555; 
        color: white; border-radius: 4px; box-sizing: border-box; font-size: 1rem;
    }
    input:focus { outline: none; border-color: var(--primary); }

    /* Tabla de Ventas (Desglose) */
    .tabla-ventas { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .tabla-ventas th { text-align: left; padding: 8px; border-bottom: 1px solid #555; color: var(--primary); }
    .tabla-ventas td { padding: 8px; border-bottom: 1px solid #333; }
    .tabla-ventas input { padding: 5px; background: transparent; border: none; border-bottom: 1px solid #555; }
    .tabla-ventas input:focus { border-color: var(--primary); }

    /* Resumen Financiero (Sticky) */
    .resumen-panel {
        background-color: #252525; padding: 20px; border-radius: 10px;
        border: 2px solid var(--primary); position: sticky; top: 20px;
    }
    .fila-total { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 1.1rem; }
    .total-final { font-size: 1.5rem; font-weight: bold; color: var(--primary); border-top: 2px solid #555; padding-top: 10px; margin-top: 10px; }
    
    .btn-print {
        width: 100%; padding: 15px; background-color: var(--primary); color: white;
        font-weight: bold; border: none; border-radius: 5px; font-size: 1.1rem; cursor: pointer; margin-top: 20px;
    }
    .btn-print:hover { background-color: #388e3c; }

    /* --- ESTILOS IMPRESI√ìN (EL FORMATO OFICIAL) --- */
    @media print {
        @page { margin: 1cm; size: letter; }
        nav, header, .btn-print, .btn-add-row { display: none !important; }
        
        body { background-color: white !important; color: black !important; font-family: 'Courier New', Courier, monospace !important; }
        
        .liquidacion-grid { display: block !important; }
        .card-section, .resumen-panel { 
            border: none !important; background: white !important; padding: 0 !important; margin-bottom: 20px !important;
            box-shadow: none !important; color: black !important;
        }

        h3 { border-bottom: 2px solid black !important; color: black !important; text-transform: uppercase; }
        
        input { 
            border: none !important; background: transparent !important; color: black !important; 
            padding: 0 !important; font-weight: bold; font-family: inherit;
        }

        .tabla-ventas th { color: black !important; border-bottom: 2px solid black !important; }
        .tabla-ventas td { border-bottom: 1px dashed #ccc !important; }

        .resumen-panel { border: 2px solid black !important; padding: 15px !important; margin-top: 30px; }
        .total-final { color: black !important; border-top: 2px solid black !important; }
        
        /* Cabecera de Impresi√≥n */
        .print-header { display: block !important; text-align: center; margin-bottom: 20px; }
        .print-header h2 { margin: 0; font-size: 1.5rem; }
        .print-header p { margin: 0; font-size: 0.9rem; }
    }
    
    .print-header { display: none; } /* Oculto en pantalla */
  </style>
</head>
<body>

  <header class="no-print">
    <h1>Liquidaciones</h1>
  </header>
  <nav class="no-print">
    <a href="menu.html">‚¨Ö Men√∫ Principal</a>
  </nav>

  <main>
    
    <!-- Cabecera solo para impresi√≥n -->
    <div class="print-header">
        <h2>DISTRIBUIDORA MEZWARE</h2>
        <p>Central de Abastos - Bodega E-45</p>
        <p>Liquidaci√≥n de Cuenta al Productor</p>
        <hr style="border: 1px solid black; margin-top: 10px;">
    </div>

    <div class="liquidacion-grid">
        
        <!-- COLUMNA IZQUIERDA (Datos y Desglose) -->
        <div class="col-datos">
            
            <!-- Datos Generales -->
            <div class="card-section">
                <h3>Datos de Recepci√≥n</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Productor / Proveedor</label>
                        <input type="text" id="productor" placeholder="Nombre del Productor">
                    </div>
                    <div class="form-group">
                        <label>Fecha de Venta</label>
                        <input type="date" id="fecha">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Producto</label>
                        <input type="text" id="producto" placeholder="Ej: Chayote Espina">
                    </div>
                    <div class="form-group">
                        <label>Cantidad Recibida</label>
                        <input type="number" id="cant-recibida" placeholder="0" oninput="calcular()">
                    </div>
                </div>
            </div>

            <!-- Desglose de Ventas (La parte de "Formatos feos" hecha bonita) -->
            <div class="card-section">
                <h3>Desglose de Venta (Por Calidad/Precio)</h3>
                <table class="tabla-ventas">
                    <thead>
                        <tr>
                            <th>Cant.</th>
                            <th>Descripci√≥n / Calidad</th>
                            <th>Precio ($)</th>
                            <th>Importe</th>
                            <th class="no-print"></th>
                        </tr>
                    </thead>
                    <tbody id="lista-ventas">
                        <!-- Fila Base 1 -->
                        <tr>
                            <td><input type="number" class="v-cant" value="0" oninput="calcular()"></td>
                            <td><input type="text" value="Primera Calidad"></td>
                            <td><input type="number" class="v-precio" value="0" oninput="calcular()"></td>
                            <td>$<span class="v-importe">0.00</span></td>
                            <td class="no-print"></td>
                        </tr>
                        <!-- Fila Base 2 -->
                        <tr>
                            <td><input type="number" class="v-cant" value="0" oninput="calcular()"></td>
                            <td><input type="text" value="Segunda / Merma"></td>
                            <td><input type="number" class="v-precio" value="0" oninput="calcular()"></td>
                            <td>$<span class="v-importe">0.00</span></td>
                            <td class="no-print"></td>
                        </tr>
                    </tbody>
                </table>
                <button class="btn-add no-print" onclick="agregarFila()" style="background: #333; color:#aaa; border:1px dashed #555; width:100%; margin-top:10px; cursor:pointer;">+ Agregar otra calidad</button>
            </div>

        </div>

        <!-- COLUMNA DERECHA (Cuentas y Totales) -->
        <div class="col-totales">
            <div class="resumen-panel">
                <h3>Resumen de Cuenta</h3>
                
                <div class="fila-total">
                    <span>Venta Bruta:</span>
                    <span id="total-venta">$0.00</span>
                </div>
                
                <hr style="border-color: #444; margin: 15px 0;">
                
                <!-- Deducciones -->
                <div class="form-group" style="margin-bottom: 10px;">
                    <label>(-) Flete / Transporte</label>
                    <input type="number" id="gasto-flete" value="0" oninput="calcular()" style="text-align: right;">
                </div>
                <div class="form-group" style="margin-bottom: 10px;">
                    <label>(-) Maniobra / Cargadores</label>
                    <input type="number" id="gasto-maniobra" value="0" oninput="calcular()" style="text-align: right;">
                </div>
                <div class="form-group" style="margin-bottom: 10px;">
                    <label>(-) Comisi√≥n (%)</label>
                    <div style="display: flex; gap: 5px;">
                        <input type="number" id="comision-porc" value="10" oninput="calcular()" style="width: 60px;">
                        <input type="text" id="comision-valor" value="$0.00" readonly style="text-align: right; border: none; background: transparent; color: #e74c3c;">
                    </div>
                </div>

                <div class="fila-total total-final">
                    <span>A LIQUIDAR:</span>
                    <span id="total-liquidar">$0.00</span>
                </div>

                <button class="btn-print" onclick="window.print()">üñ®Ô∏è Imprimir Nota</button>
            </div>
        </div>

    </div>

  </main>

  <script>
    // FECHA HOY
    document.getElementById('fecha').valueAsDate = new Date();

    // AGREGAR FILA DIN√ÅMICA
    function agregarFila() {
        const tbody = document.getElementById('lista-ventas');
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><input type="number" class="v-cant" value="0" oninput="calcular()"></td>
            <td><input type="text" placeholder="Descripci√≥n..."></td>
            <td><input type="number" class="v-precio" value="0" oninput="calcular()"></td>
            <td>$<span class="v-importe">0.00</span></td>
            <td class="no-print"><button onclick="this.parentElement.parentElement.remove(); calcular()" style="color:red; background:none; border:none; cursor:pointer;">X</button></td>
        `;
        tbody.appendChild(row);
    }

    // C√ÅLCULO MATEM√ÅTICO EN TIEMPO REAL
    function calcular() {
        let totalVenta = 0;

        // 1. Sumar filas de venta
        const filas = document.querySelectorAll('#lista-ventas tr');
        filas.forEach(tr => {
            const cant = Number(tr.querySelector('.v-cant').value) || 0;
            const precio = Number(tr.querySelector('.v-precio').value) || 0;
            const importe = cant * precio;
            
            tr.querySelector('.v-importe').innerText = importe.toFixed(2);
            totalVenta += importe;
        });

        // 2. Calcular Gastos
        const flete = Number(document.getElementById('gasto-flete').value) || 0;
        const maniobra = Number(document.getElementById('gasto-maniobra').value) || 0;
        
        const porcComision = Number(document.getElementById('comision-porc').value) || 0;
        const valorComision = totalVenta * (porcComision / 100);

        // 3. Totales Finales
        const totalLiquidar = totalVenta - flete - maniobra - valorComision;

        // 4. Actualizar DOM
        document.getElementById('total-venta').innerText = formatear(totalVenta);
        document.getElementById('comision-valor').value = formatear(valorComision); // Input readonly
        document.getElementById('total-liquidar').innerText = formatear(totalLiquidar);
    }

    function formatear(num) {
        return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(num);
    }

    // Calcular al inicio
    calcular();
  </script>

</body>
</html>